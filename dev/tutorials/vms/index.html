<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Virtual Model Control of a Simulated Robot · VMRobotControl.jl</title><meta name="title" content="Virtual Model Control of a Simulated Robot · VMRobotControl.jl"/><meta property="og:title" content="Virtual Model Control of a Simulated Robot · VMRobotControl.jl"/><meta property="twitter:title" content="Virtual Model Control of a Simulated Robot · VMRobotControl.jl"/><meta name="description" content="Documentation for VMRobotControl.jl."/><meta property="og:description" content="Documentation for VMRobotControl.jl."/><meta property="twitter:description" content="Documentation for VMRobotControl.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VMRobotControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../introduction/">Introduction</a></li><li><a class="tocitem" href="../building/">Building a mechanism</a></li><li><a class="tocitem" href="../using/">Using a mechanism</a></li><li class="is-active"><a class="tocitem" href>Virtual Model Control of a Simulated Robot</a><ul class="internal"><li><a class="tocitem" href="#What-is-a-virtual-mechanism-system?"><span>What is a virtual mechanism system?</span></a></li><li><a class="tocitem" href="#Connecting-a-spring/damper-between-a-robot-and-a-virtual-mechanism."><span>Connecting a spring/damper between a robot and a virtual mechanism.</span></a></li><li><a class="tocitem" href="#Using-a-virtual-mechanism-system"><span>Using a virtual mechanism system</span></a></li></ul></li><li><a class="tocitem" href="../plotting/">Plotting with Makie.jl</a></li><li><a class="tocitem" href="../simulating/">Simulating with DifferentialEquations.jl</a></li><li><a class="tocitem" href="../control/">Virtual Model Control of a Real Robot using ROS</a></li><li><a class="tocitem" href="../optimization/">Optimization</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/franka_impedance_control/">Franka Impedance Control</a></li><li><a class="tocitem" href="../../examples/sciurus_reaching/">Sciurus reaching with obstacle avoidance</a></li><li><a class="tocitem" href="../../examples/compliant_path_following/">Franka compliant path following</a></li><li><a class="tocitem" href="../../examples/rail_robot/">Pendulum on a Bezier-Spline Rail</a></li></ul></li><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../developer/developer/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Virtual Model Control of a Simulated Robot</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Virtual Model Control of a Simulated Robot</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl/blob/main/docs/src/tutorials/vms.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Virtual-Model-Control-of-a-Simulated-Robot"><a class="docs-heading-anchor" href="#Virtual-Model-Control-of-a-Simulated-Robot">Virtual Model Control of a Simulated Robot</a><a id="Virtual-Model-Control-of-a-Simulated-Robot-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-Model-Control-of-a-Simulated-Robot" title="Permalink"></a></h1><h2 id="What-is-a-virtual-mechanism-system?"><a class="docs-heading-anchor" href="#What-is-a-virtual-mechanism-system?">What is a virtual mechanism system?</a><a id="What-is-a-virtual-mechanism-system?-1"></a><a class="docs-heading-anchor-permalink" href="#What-is-a-virtual-mechanism-system?" title="Permalink"></a></h2><p>A virtual mechanism system is contains a model of the robot, a model of a virtual mechanism and  interface components that act between the robot and the virtual mechanism. It can be used for two purposes: either for simulation or for control of a real robot. If used for simulation, a full robot model is needed, with dynamic components (like mass/inertia). If used for control, the robot model is still needed, but at a minimum only a kinematics model is needed (frames, joints and coordinates) so no inertial model is nescessary. When controlling a real robot, <em>components on the robot are ignored</em>.</p><p>The <a href="../../api/api/#VMRobotControl.VirtualMechanismSystem"><code>VirtualMechanismSystem</code></a> thus contains a <code>robot::Mechanism</code>, a  <code>virtual_mechanism::Mechanism</code>, which can be built just like a robot, and also contains it&#39;s own <code>coordinates</code> and <code>components</code> that connect <em>between</em> the robot and virtual mechanism.</p><h2 id="Connecting-a-spring/damper-between-a-robot-and-a-virtual-mechanism."><a class="docs-heading-anchor" href="#Connecting-a-spring/damper-between-a-robot-and-a-virtual-mechanism.">Connecting a spring/damper between a robot and a virtual mechanism.</a><a id="Connecting-a-spring/damper-between-a-robot-and-a-virtual-mechanism.-1"></a><a class="docs-heading-anchor-permalink" href="#Connecting-a-spring/damper-between-a-robot-and-a-virtual-mechanism." title="Permalink"></a></h2><p>First, lets build a super simple virtual mechanism system. It will consist of a 1DOF robot, and a 1DOF virtual mechanism. A virtual spring and damper will join the two together.</p><p>First, we make the robot, virtual mechanism, and virtual mechanism system.</p><pre><code class="language-julia hljs">using VMRobotControl, StaticArrays

robot = Mechanism{Float64}(&quot;Piston&quot;)
add_frame!(robot, &quot;L1&quot;)
add_joint!(robot, Prismatic(SVector(1.0, 0.0, 0.0)); parent=&quot;root_frame&quot;, child=&quot;L1&quot;, id=&quot;J1&quot;)
add_coordinate!(robot, FrameOrigin(&quot;L1&quot;); id=&quot;ee_pos&quot;)
virtual_mechanism = deepcopy(robot)
vms = VirtualMechanismSystem(&quot;MySystem&quot;, robot, virtual_mechanism)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">VirtualMechanismSystem &#39;MySystem&#39; with robot `Piston`, and virtual mechanism `Piston`.</code></pre><p>Then, we add a coordinate to the virtual mechanism system using <a href="../../api/api/#VMRobotControl.CoordDifference"><code>CoordDifference</code></a> which will is the typical way to define a coordinate between the robot and virtual mechanism. It represents a vector from the tip of the robot end-effector to the tip of the virtual mechanism end-effector. To identify robot/virtual mechanism coordinates from the virtual-mechanism-system, the prefixes <code>&quot;.robot.&quot;</code> or <code>&quot;.virtual_mechanism.&quot;</code> must be used.</p><pre><code class="language-julia hljs">add_coordinate!(vms, CoordDifference(&quot;.robot.ee_pos&quot;, &quot;.virtual_mechanism.ee_pos&quot;); id=&quot;ee_err&quot;)
add_component!(vms, LinearSpring(100.0, &quot;ee_err&quot;); id=&quot;ee_spring&quot;)
add_component!(vms, LinearDamper(1.0, &quot;ee_err&quot;); id=&quot;ee_damper&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;ee_damper&quot;</code></pre><p>We can only add spring/damper like components to the virtual mechanism system, and not inertias/ masses/inertances. This is because the robot/virtual mechanism both act as admitances (taking forces as input, and  computing accelerations as outputs), so the interface between them must act as an impedance (taking motion as input and returning a force).</p><h2 id="Using-a-virtual-mechanism-system"><a class="docs-heading-anchor" href="#Using-a-virtual-mechanism-system">Using a virtual mechanism system</a><a id="Using-a-virtual-mechanism-system-1"></a><a class="docs-heading-anchor-permalink" href="#Using-a-virtual-mechanism-system" title="Permalink"></a></h2><p>The interface for using a virtual mechanism system is broadly the same as for using mechanism. However, joint configurations, velocities and actuation torques must now be tuples, with the  first entry corresponding to the robot and the second to the virtual mechanism</p><pre><code class="language-julia-repl hljs" style="display:block;">julia&gt; m = compile(vms)</code><code class="nohighlight hljs ansi" style="display:block;">CompiledVirtualMechanismSystem{Float64, ...}(MySystem...)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; t = 0.0</code><code class="nohighlight hljs ansi" style="display:block;">0.0</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; q = zero_q(m)</code><code class="nohighlight hljs ansi" style="display:block;">([0.0], [0.0])</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; kcache = new_kinematics_cache(m)</code><code class="nohighlight hljs ansi" style="display:block;">VMSKinematicsBundle{...}(&quot;MySystem&quot;, ...)</code><br/><code class="language-julia-repl hljs" style="display:block;">julia&gt; kinematics!(kcache, t, q)</code><code class="nohighlight hljs ansi" style="display:block;"></code></pre><p>Note that q is a tuple </p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../using/">« Using a mechanism</a><a class="docs-footer-nextpage" href="../plotting/">Plotting with Makie.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 16 January 2025 19:46">Thursday 16 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
