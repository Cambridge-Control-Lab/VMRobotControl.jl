<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Plotting with Makie.jl · VMRobotControl.jl</title><meta name="title" content="Plotting with Makie.jl · VMRobotControl.jl"/><meta property="og:title" content="Plotting with Makie.jl · VMRobotControl.jl"/><meta property="twitter:title" content="Plotting with Makie.jl · VMRobotControl.jl"/><meta name="description" content="Documentation for VMRobotControl.jl."/><meta property="og:description" content="Documentation for VMRobotControl.jl."/><meta property="twitter:description" content="Documentation for VMRobotControl.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VMRobotControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../introduction/">Introduction</a></li><li><a class="tocitem" href="../building/">Building a mechanism</a></li><li><a class="tocitem" href="../using/">Using a mechanism</a></li><li><a class="tocitem" href="../vms/">Virtual Model Control of a Simulated Robot</a></li><li class="is-active"><a class="tocitem" href>Plotting with Makie.jl</a></li><li><a class="tocitem" href="../simulating/">Simulating with DifferentialEquations.jl</a></li><li><a class="tocitem" href="../control/">Virtual Model Control of a Real Robot using ROS</a></li><li><a class="tocitem" href="../optimization/">Optimization</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/franka_impedance_control/">Franka Impedance Control</a></li><li><a class="tocitem" href="../../examples/sciurus_reaching/">Sciurus reaching with obstacle avoidance</a></li><li><a class="tocitem" href="../../examples/compliant_path_following/">Franka compliant path following</a></li><li><a class="tocitem" href="../../examples/rail_robot/">Pendulum on a Bezier-Spline Rail</a></li></ul></li><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../developer/developer/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Plotting with Makie.jl</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Plotting with Makie.jl</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl/blob/main/docs/src/tutorials/plotting.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Plotting-with-Makie"><a class="docs-heading-anchor" href="#Plotting-with-Makie">Plotting with Makie</a><a id="Plotting-with-Makie-1"></a><a class="docs-heading-anchor-permalink" href="#Plotting-with-Makie" title="Permalink"></a></h1><p>In this tutorial, we will demonstrate how to plot the robot using  <a href="https://docs.makie.org/v0.21/"><code>GLMakie</code></a>. Some familiarity with the Makie plotting ecosystem is required.</p><p>The code supporting plotting with Makie is defined in the extension  <code>&quot;./ext/VMRobotControlMakieExt.jl&quot;</code>, and where you should look if you are trying anything complicated!</p><p>Here is a simple example of plotting a mechanism loaded from a URDF.</p><pre><code class="language-julia hljs">using DifferentialEquations
using GLMakie
using VMRobotControl
using StaticArrays

using FileIO
using UUIDs
    try FileIO.add_format(format&quot;DAE&quot;, (), &quot;.dae&quot;, [:DigitalAssetExchangeFormatIO =&gt; UUID(&quot;43182933-f65b-495a-9e05-4d939cea427d&quot;)])
catch e
end

cfg = URDFParserConfig(suppress_warnings=true)
mechanism = parseURDF(&quot;../../../URDFs/franka_description/urdfs/fr3.urdf&quot;, cfg)
m = compile(mechanism)
kcache = Observable(new_kinematics_cache(m))

# Setup the figure
fig1 = Figure(size=(700, 350))
ls1 = LScene(fig1[1, 1]; show_axis=false)
ls2 = LScene(fig1[1, 2]; show_axis=false)

# Plot the robot&#39;s visuals
robotvisualize!(ls1, kcache)
# Or a sketch of it&#39;s kinematic structure
robotsketch!(ls2, kcache; scale=0.3, linewidth=2.5, transparency=true)

save(&quot;robotplot1.png&quot;, fig1)</code></pre><p><img src="../robotplot1.png" alt/></p><p><code>robotvisualize</code> is used to show visual components, whereas <code>robotsketch</code> creates a line-sketch based upon the joints of the robot.</p><p>This uses the <code>Observable</code> interface favoured by Makie, which means that when the cache is notified of a change (which can be done manually with <code>notify</code>), the plot is automatically updated. Here, we change the contents of the kinematics cache and notify, causing the plot to change:</p><pre><code class="language-julia hljs">t = 0.0
q = Float64[0.0, 0.0, 0.0, -pi/2, pi/2, pi/2, 0.0]
kinematics!(kcache[], t, q)
notify(kcache)
save(&quot;robotplot2.png&quot;, fig1)</code></pre><p><img src="../robotplot2.png" alt/></p><p><code>CompiledFrameID</code>s and certain <code>CompiledCoordIDs</code> can be used to plot. Plotting a frame IDs are  converted to points at the origin of the frame, and suitable coord IDs are converted to one or more points in the root frame of the mechanism. For example:</p><pre><code class="language-julia hljs">coord_id = get_compiled_coordID(m, &quot;fr3_link5_mass_coord&quot;)
frame_id = get_compiled_frameID(m, &quot;fr3_link8&quot;)

scatter!(ls2, kcache,  [coord_id, frame_id]; color=:red, markersize=10)
text!(ls2, kcache, [coord_id, frame_id]; text=[&quot;link 7 centre of mass&quot;, &quot;link 8 origin&quot;], color=:blue)
save(&quot;robotplot3.png&quot;, fig1)</code></pre><p><img src="../robotplot3.png" alt/></p><p>There is also support for animating <code>ODESolutions</code> from <code>DifferentialEquations.jl</code>. This is via the function <code>animate_robot_odesolution</code>. For details of performing a simulation, read the simulation tutorial.</p><p>To do an animation, you simply need to create a plot using an <code>Observable</code> of the kinematics  cache. The function <code>animate_robot_odesolution</code> will update the configuration of the mechanism based upon the state of the ODE solution, and notify the kinematics cache, and all of the plots you  have created will update.</p><pre><code class="language-julia hljs">q̇ = zero_q̇(m)
T = 3.0

dcache = new_dynamics_cache(m)
g = VMRobotControl.DEFAULT_GRAVITY
prob = get_ode_problem(dcache, g, q, q̇, T)
sol = solve(prob, Tsit5(), abstol=1e-10, reltol=1e-10)

fps = 60
N_frames = Int(floor(fps*T))
ts = LinRange(0.0, T, N_frames)
animate_robot_odesolution(fig1, sol, kcache, &quot;robot_animation.mp4&quot;)</code></pre><pre class="documenter-example-output"><code class="nohighlight hljs ansi">&quot;robot_animation.mp4&quot;</code></pre><p><video src="../robot_animation.mp4" controls="true" title><a href="../robot_animation.mp4"></a></video></p><p>Makie supports timeseries plots of ode-solution states directly. We can also use the <code>sol(t)</code> interface to access the state at a particular time and compute values, such as the stored energy. This is demonstrated  below.</p><pre><code class="language-julia hljs">function energy(t)
    s = sol(t)
    q_idxs, q̇_idxs = state_idxs(m)
    q, q̇ = s[q_idxs], s[q̇_idxs]
    u = zero_u(m)
    dynamics!(dcache, t, q, q̇, g, u)
    stored_energy(dcache)
end
ts = LinRange(0, T, 100)

fig2 = Figure()
ax = Axis(fig2[1, 1])
l1 = lines!(ax, sol)
l2 = lines!(ax, ts, energy.(ts), label=&quot;energy&quot;; color=:black, linewidth=3.0)
Legend(fig2[1, 2], ax;)
save(&quot;energy_plot.png&quot;, fig2)</code></pre><p><img src="../energy_plot.png" alt/></p><p>As the mechanism we loaded has no dissipation components, only modelling point masses and inertias, the total stored energy is constant. This is a useful check to see if the implementation of you dynamics is correct!</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../vms/">« Virtual Model Control of a Simulated Robot</a><a class="docs-footer-nextpage" href="../simulating/">Simulating with DifferentialEquations.jl »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.1 on <span class="colophon-date" title="Monday 17 February 2025 12:19">Monday 17 February 2025</span>. Using Julia version 1.11.3.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
