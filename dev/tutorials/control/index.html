<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Virtual Model Control of a Real Robot using ROS · VMRobotControl.jl</title><meta name="title" content="Virtual Model Control of a Real Robot using ROS · VMRobotControl.jl"/><meta property="og:title" content="Virtual Model Control of a Real Robot using ROS · VMRobotControl.jl"/><meta property="twitter:title" content="Virtual Model Control of a Real Robot using ROS · VMRobotControl.jl"/><meta name="description" content="Documentation for VMRobotControl.jl."/><meta property="og:description" content="Documentation for VMRobotControl.jl."/><meta property="twitter:description" content="Documentation for VMRobotControl.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><div class="docs-package-name"><span class="docs-autofit"><a href="../../">VMRobotControl.jl</a></span></div><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><span class="tocitem">Tutorials</span><ul><li><a class="tocitem" href="../introduction/">Introduction</a></li><li><a class="tocitem" href="../building/">Building a mechanism</a></li><li><a class="tocitem" href="../using/">Using a mechanism</a></li><li><a class="tocitem" href="../vms/">Virtual Model Control of a Simulated Robot</a></li><li><a class="tocitem" href="../plotting/">Plotting with Makie.jl</a></li><li><a class="tocitem" href="../simulating/">Simulating with DifferentialEquations.jl</a></li><li class="is-active"><a class="tocitem" href>Virtual Model Control of a Real Robot using ROS</a><ul class="internal"><li class="toplevel"><a class="tocitem" href="#Implementing-your-own-realtime-control"><span>Implementing your own realtime control</span></a></li></ul></li><li><a class="tocitem" href="../optimization/">Optimization</a></li></ul></li><li><span class="tocitem">Examples</span><ul><li><a class="tocitem" href="../../examples/franka_impedance_control/">Franka Impedance Control</a></li><li><a class="tocitem" href="../../examples/sciurus_reaching/">Sciurus reaching with obstacle avoidance</a></li><li><a class="tocitem" href="../../examples/compliant_path_following/">Franka compliant path following</a></li><li><a class="tocitem" href="../../examples/rail_robot/">Pendulum on a Bezier-Spline Rail</a></li></ul></li><li><a class="tocitem" href="../../api/api/">API</a></li><li><a class="tocitem" href="../../developer/developer/">Developer Notes</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Virtual Model Control of a Real Robot using ROS</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Virtual Model Control of a Real Robot using ROS</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/Cambridge-Control-Lab/VMRobotControl.jl/blob/main/docs/src/tutorials/control.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Virtual-Model-Control-of-a-Real-Robot-using-ROS"><a class="docs-heading-anchor" href="#Virtual-Model-Control-of-a-Real-Robot-using-ROS">Virtual Model Control of a Real Robot using ROS</a><a id="Virtual-Model-Control-of-a-Real-Robot-using-ROS-1"></a><a class="docs-heading-anchor-permalink" href="#Virtual-Model-Control-of-a-Real-Robot-using-ROS" title="Permalink"></a></h1><p>This library is not just for simulation, but can be used for realtime control of torque-controlled robots. The library aims to avoid any allocations so that it can be used in tight loops without invoking the garbage collector.</p><p>We provide a way to communicate over ros using the python script <code>./ros/rospy_client.py</code>. This can  communicate with a julia controller using TCP/UDP sockets. </p><p>To use it, run this script with python 3, providing the required command line arguments. These are the number of degrees of freedom of the robot (the length of the torque/effort vector), the name of the name of the topic to send joint torque commands to, and the name of the topic to subscribe to  joint state updates on. All command line arguments can be viewed by calling with <code>--help</code>.</p><p>The ROS interface was written and tested with the help of Yi Zhang to control the Sciurus robot.</p><h1 id="Implementing-your-own-realtime-control"><a class="docs-heading-anchor" href="#Implementing-your-own-realtime-control">Implementing your own realtime control</a><a id="Implementing-your-own-realtime-control-1"></a><a class="docs-heading-anchor-permalink" href="#Implementing-your-own-realtime-control" title="Permalink"></a></h1><p>The library provides an interface for realtime control via the two methods:</p><ul><li><a href="../../api/api/#VMRobotControl.new_control_cache"><code>new_control_cache</code></a> and</li><li><a href="../../api/api/#VMRobotControl.control_step!"><code>control_step!</code></a></li></ul><p>New control cache creates a cache bundle: a structure containing the mechanism and a cache for  storing intermediate computations.</p><p>The step function should be called once per loop, and needs to be provided with the current state: the time <code>t</code>, joint configurations <code>q</code>, and joint velocities <code>q̇</code>. Then the effect of the virtual mechanism system is applied in two steps:</p><ul><li>The virtual mechanism advances in time to <code>t</code> (by taking one euler step)</li><li>The new demanded robot torques are returned</li></ul><p>Any component added to the robot is treated as part of the model of the robot, not as part of the  controller. Therefore, any component added directly to the robot is ignored by <code>control_step!</code> and  does not generate any forces/torques. If you wish to create a components that acts upon the robot, it must be added to the  <code>VirtualMechanismSystem</code> and may use coordinates from the robot by prefixing the id with <code>&quot;.robot.&quot;</code>.</p><p>For example, if I have a robot with coordinate <code>&quot;tip_error&quot;</code>, I can create a spring using coordinate <code>&quot;tip_error&quot;</code> by using <code>&quot;.robot.tip_error&quot;</code>:</p><pre><code class="nohighlight hljs">vms = VirtualMechanismSystem(&quot;MyVMS&quot;, robot, virtual_mechanism)
spring = LinearSpring(1000.0, &quot;.robot.tip_error&quot;)
add_component!(vms, spring; id=&quot;Tip spring&quot;)</code></pre><p>If instead I did</p><pre><code class="nohighlight hljs">spring = LinearSpring(1000.0, &quot;tip_error&quot;)
add_component!(robot, spring; id=&quot;Tip spring&quot;)
vms = VirtualMechanismSystem(&quot;MyVMS&quot;, robot, virtual_mechanism)</code></pre><p>then the controller will not apply a force due to the spring, because it thinks the spring already  exists and is part of the actual robot.</p></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../simulating/">« Simulating with DifferentialEquations.jl</a><a class="docs-footer-nextpage" href="../optimization/">Optimization »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.8.0 on <span class="colophon-date" title="Thursday 16 January 2025 19:46">Thursday 16 January 2025</span>. Using Julia version 1.11.2.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
